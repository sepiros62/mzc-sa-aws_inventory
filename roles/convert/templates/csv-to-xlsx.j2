#-*- coding:utf-8 -*-
import os
import csv
import sys

from openpyxl import Workbook
from openpyxl.styles import PatternFill, Border, Side, Alignment, Protection, Font

bd = Side(style='thin', color="000000")
default_border = Border(left=bd, top=bd, right=bd, bottom=bd)
gray_fill = PatternFill("solid", fgColor="00C0C0C0")

bottom_line = Border(bottom=Side(border_style="medium", color='00FF0000'))
thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), top=Side(style='thin'), bottom=Side(style='thin'))

ft_head_line = Font(name="Malgun Gothic", size="24", bold=True)
ft_mid_line = Font(name="Malgun Gothic", size="11", bold=True)
ft_bot_line = Font(name="Malgun Gothic", size="10", bold=True)
ft_con_line = Font(name="Arial", size="7", bold=False)

center_alignment = Alignment(horizontal="center", vertical="center")

def excel_initialized(sheet_name):
    ws = sheet_name
    ws.row_dimensions[1].height = 16
    ws.row_dimensions[2].height = 15
    ws.row_dimensions[3].height = 15
    ws.row_dimensions[4].height = 15
    ws.row_dimensions[5].height = 15
    ws.row_dimensions[6].height = 15
    ws.row_dimensions[7].height = 15
    ws.row_dimensions[8].height = 15

    ws.column_dimensions['A'].width = 10
    ws.column_dimensions['B'].width = 60
    ws.column_dimensions['C'].width = 20
    ws.column_dimensions['D'].width = 13
    ws.column_dimensions['E'].width = 13
    ws.column_dimensions['F'].width = 24
    ws.column_dimensions['G'].width = 13
    ws.column_dimensions['H'].width = 16

#    title_cell = ws.cell(row=2, column=2, value="Megazone Infra Monthly Report")
#    title_cell.font = ft_head_line
#    title_cell.border = bottom_line

#    ws['b6'].font = ft_bot_line
#    ws['b6'].fill = gray_fill
#    ws.merge_cells('B2:J2')

def private_cell_merge(worksheets, sr, er, sc, ec):
    worksheets.merge_cells(start_row=sr, end_row=er, start_column=sc, end_column=ec)
    return ec + 1

def subject_style(sheetname):
    sheetname.font = ft_bot_line
    sheetname.fill = gray_fill
    sheetname.alignment = center_alignment
    sheetname.border = default_border

def con_style(sheetname):
    sheetname.alignment = center_alignment
    sheetname.border = default_border
    sheetname.font = ft_con_line

# Main
wb = Workbook()
dest_filename = '{{ slack_file_name }}.xlsx'

ws1 = wb.active
ws1.title = 'EC2'
ws1['A1'] = '[AWS] EC2 Resource'
ws1.sheet_properties.tabColor = "00808080"
ws1.column_dimensions['A'].width = "8"
ws1.column_dimensions['B'].width = "20"
ws1.column_dimensions['C'].width = "20"
ws1.column_dimensions['D'].width = "13"
ws1.column_dimensions['E'].width = "16"
ws1.column_dimensions['F'].width = "15"
ws1.column_dimensions['G'].width = "15"
ws1.column_dimensions['H'].width = "25"
ws1.column_dimensions['I'].width = "18"
ws1.cell(row=7, column=9).border = thin_border

ws2 = wb.create_sheet()
ws2.title = "VPC"
ws2['A1'] = '[AWS] VPC Resource'
ws2.sheet_properties.tabColor = "00FFCC99"
ws2.column_dimensions['A'].width = "8"
ws2.column_dimensions['B'].width = "35"
ws2.column_dimensions['C'].width = "35"
ws2.column_dimensions['D'].width = "40"
ws2.column_dimensions['E'].width = "30"

ws3 = wb.create_sheet()
ws3.title = "S3"
ws3['A1'] = '[AWS] S3 Resource'
ws3.sheet_properties.tabColor = "0033CCCC"
ws3.column_dimensions['A'].width = "8"
ws3.column_dimensions['B'].width = "50"

ws4 = wb.create_sheet()
ws4.title = "CF"
ws4.sheet_properties.tabColor = "0099CC00"
ws4['A1'] = '[AWS] CF Resource'
ws4.column_dimensions['A'].width = "8"
ws4.column_dimensions['B'].width = "18"
ws4.column_dimensions['C'].width = "10"
ws4.column_dimensions['D'].width = "40"

ws5 = wb.create_sheet()
ws5.title = "RDS"
ws5['A1'] = '[AWS] RDS Resource'
ws5.sheet_properties.tabColor = "0099CCFF"
ws5.column_dimensions['A'].width = "8"
ws5.column_dimensions['B'].width = "30"
ws5.column_dimensions['C'].width = "13"
ws5.column_dimensions['D'].width = "22"
ws5.column_dimensions['E'].width = "70"

ws6 = wb.create_sheet()
ws6.title = "ROUTE53"
ws6['A1'] = '[AWS] Route53 Resource'
ws6.sheet_properties.tabColor = "009999FF"
ws6.column_dimensions['A'].width = "8"
ws6.column_dimensions['B'].width = "20"
ws6.column_dimensions['C'].width = "30"
ws6.column_dimensions['C'].width = "30"

ws7 = wb.create_sheet()
ws7.title = "SG"
ws7['A1'] = '[AWS] SecurityGroup Resource'
ws7.sheet_properties.tabColor = "00FF8080"
ws7.column_dimensions['A'].width = "8"
ws7.column_dimensions['B'].width = "40"
ws7.column_dimensions['C'].width = "23"
ws7.column_dimensions['D'].width = "10"
ws7.column_dimensions['E'].width = "10"
ws7.column_dimensions['F'].width = "80"
ws7.column_dimensions['G'].width = "80"

with open('ec2-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws1.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)

with open('vpc-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws2.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)

with open('s3-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws3.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)

with open('cf-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws4.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)

with open('rds-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws5.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)

with open('route53-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws6.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)

with open('sg-report.csv', 'r') as f:
    reader = csv.reader(f)
    for r, row in enumerate(reader):
        for c, col in enumerate(row):
            for idx, val in enumerate(col.split(',')):
              cell = ws7.cell(row=r+1, column=c+1)
              cell.value = val
    wb.save(filename = dest_filename)